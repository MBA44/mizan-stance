<link rel="canonical" href="https://mizan-stance.org{{ page.url }}">

{% set site = "https://mizan-stance.org" %}
{% set p = page.url %}
{% set currentLang = lang or metadata.language or "fr" %}

{# x-default partout #}
<link rel="alternate" hreflang="x-default" href="{{ site }}/" />

{# Home #}
{% if p == "/" %}
  <link rel="alternate" hreflang="fr" href="{{ site }}/fr/" />
  <link rel="alternate" hreflang="en" href="{{ site }}/en/" />

{% else %}

  {# Si la page fournit une traduction explicite, on l’utilise (cas /fr/a-propos/ ↔ /en/about/) #}
  {% if translation %}
    <link rel="alternate" hreflang="{{ currentLang }}" href="{{ site }}{{ p }}" />
    <link rel="alternate" hreflang="{{ "en" if currentLang == "fr" else "fr" }}" href="{{ site }}{{ translation }}" />

  {% else %}
    {# Fallback miroir uniquement si c’est strictement /fr/… ou /en/… #}
    {% if p.startsWith("/fr/") %}
      <link rel="alternate" hreflang="fr" href="{{ site }}{{ p }}" />
      <link rel="alternate" hreflang="en" href="{{ site }}{{ p | replace('/fr/', '/en/') }}" />
    {% elif p.startsWith("/en/") %}
      <link rel="alternate" hreflang="en" href="{{ site }}{{ p }}" />
      <link rel="alternate" hreflang="fr" href="{{ site }}{{ p | replace('/en/', '/fr/') }}" />
    {% endif %}
  {% endif %}

{% endif %}